import asyncio
import os
from aiogram import Bot, Dispatcher, types, F
from aiogram.filters import Command
from aiogram.types import ReplyKeyboardMarkup, KeyboardButton

# —Ç–æ–∫–µ–Ω –±–µ—Ä–µ–º –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è
TOKEN = os.getenv("BOT_TOKEN")
bot = Bot(token=TOKEN)
dp = Dispatcher()

# --- –ú–µ–Ω—é –ø–∏—Ü—Ü ---
pizzas = {
    "–ú–∞—Ä–≥–∞—Ä–∏—Ç–∞": {"price": 195, "desc": "–ü–∏—Ü—Ü–∞-—Å–æ—É—Å, –º–Ω–æ–≥–æ —Å—ã—Ä–∞ '–ú–æ—Ü–∞—Ä–µ–ª–ª–∞', –æ—Ä–µ–≥–∞–Ω–æ"},
    "–ì–∞–≤–∞–π—Å–∫–∞—è": {"price": 295, "desc": "–ü–∏—Ü—Ü–∞-—Å–æ—É—Å, –∞–Ω–∞–Ω–∞—Å, –≤–µ—Ç—á–∏–Ω–∞, —Å—ã—Ä '–ú–æ—Ü–∞—Ä–µ–ª–ª–∞'"},
    "–¶—ã–ø–ª—ë–Ω–æ–∫ –ë–∞—Ä–±–µ–∫—é": {"price": 295, "desc": "–°–æ—É—Å –±–∞—Ä–±–µ–∫—é, –∫—Ä–∞—Å–Ω—ã–π –ª—É–∫, —Ü—ã–ø–ª–µ–Ω–æ–∫, –±–µ–∫–æ–Ω, —Å—ã—Ä '–ú–æ—Ü–∞—Ä–µ–ª–ª–∞'"},
    "–ì—Ä–∏–±–Ω–∞—è": {"price": 250, "desc": "–ß–µ—Å–Ω–æ—á–Ω—ã–π —Å–æ—É—Å, —à–∞–º–ø–∏–Ω—å–æ–Ω—ã, –≤–µ—Ç—á–∏–Ω–∞, —Å—ã—Ä '–ú–æ—Ü–∞—Ä–µ–ª–ª–∞'"},
    "–°—ã—Ä–Ω–∞—è –∫—É—Ä–æ—á–∫–∞": {"price": 315, "desc": "–°—ã—Ä–Ω—ã–π —Å–æ—É—Å, –¶—ã–ø–ª–µ–Ω–æ–∫, –º–Ω–æ–≥–æ —Å—ã—Ä–∞ '–ú–æ—Ü–∞—Ä–µ–ª–ª–∞', –∫—É–Ω–∂—É—Ç–Ω—ã–µ –±–æ—Ä—Ç–∏–∫–∏"},
    "–ü–µ–ø–ø–µ—Ä–æ–Ω–∏": {"price": 295, "desc": "–ü–∏—Ü—Ü–∞-—Å–æ—É—Å, –∫–æ–ª–±–∞—Å–∫–∏ '–ü–µ–ø–ø–µ—Ä–æ–Ω–∏', –º–Ω–æ–≥–æ —Å—ã—Ä–∞ '–ú–æ—Ü–∞—Ä–µ–ª–ª–∞'"},
    "–§–∏—Ä–º–µ–Ω–Ω–∞—è Prosto": {"price": 295, "desc": "–ü–∏—Ü—Ü–∞-—Å–æ—É—Å, —à–∞–º–ø–∏–Ω—å–æ–Ω—ã, —Å–ª–∞–¥–∫–∏–π –ø–µ—Ä–µ—Ü, –∫—Ä–∞—Å–Ω—ã–π –ª—É–∫, –º–∞—Å–ª–∏–Ω—ã, —Ü—ã–ø–ª–µ–Ω–æ–∫, –∫–æ–ª–±–∞—Å–∫–∏ '–ü–µ–ø–ø–µ—Ä–æ–Ω–∏', —Å—ã—Ä '–ú–æ—Ü–∞—Ä–µ–ª–ª–∞'"},
    "–î–≤–æ–π–Ω–∞—è –ü–µ–ø–ø–µ—Ä–æ–Ω–∏": {"price": 315, "desc": "–ü–∏—Ü—Ü–∞-—Å–æ—É—Å, —Å—ã—Ä –ú–æ—Ü–∞—Ä–µ–ª–ª–∞, –∫–æ–ª–±–∞—Å–∫–∏ –ü–µ–ø–ø–µ—Ä–æ–Ω–∏"},
    "–ö–∞–Ω—Ç—Ä–∏": {"price": 315, "desc": "–°–æ—É—Å –°—ã—Ä–Ω—ã–π, –≤–µ—Ç—á–∏–Ω–∞, –æ–º–ª–µ—Ç, —à–∞–º–ø–∏–Ω—å–æ–Ω—ã, —Ç–æ–º–∞—Ç—ã, —Å—ã—Ä –ú–æ—Ü–∞—Ä–µ–ª–ª–∞, –±–µ–∫–æ–Ω"},
    "–°—Ä–µ–¥–∏–∑–µ–º–Ω–∞—è": {"price": 335, "desc": "–ü–∏—Ü—Ü–∞-—Å–æ—É—Å, —Ç–æ–º–∞—Ç—ã, —à–∞–º–ø–∏–Ω—å–æ–Ω—ã, —Å–ª–∞–¥–∫–∏–π –ø–µ—Ä–µ—Ü, –∫—Ä–∞—Å–Ω—ã–π –ª—É–∫, –æ—Ä–µ–≥–∞–Ω–æ, —Å—ã—Ä '–§–µ—Ç–∞', –º–∞—Å–ª–∏–Ω—ã, —Å—ã—Ä '–ú–æ—Ü–∞—Ä–µ–ª–ª–∞'"},
    "–ß–∏–∫–µ–Ω –†–∞–Ω—á": {"price": 315, "desc": "–°–æ—É—Å '–†–∞–Ω—á', –¢–æ–º–∞—Ç—ã, –ß–µ—Å–Ω–æ–∫, –¶—ã–ø–ª–µ–Ω–æ–∫, –í–µ—Ç—á–∏–Ω–∞, –°—ã—Ä '–ú–æ—Ü–∞—Ä–µ–ª–ª–∞'"},
    "–ß–µ—Ç—ã—Ä–µ —Å—ã—Ä–∞": {"price": 315, "desc": "–ü–∏—Ü—Ü–∞-—Å–æ—É—Å, —Å—ã—Ä '–§–µ—Ç–∞', –°–ª–∏–≤–æ—á–Ω—ã–π —Å—ã—Ä, –ü–∞—Ä–º–µ–∑–∞–Ω, —Å—ã—Ä '–ú–æ—Ü–∞—Ä–µ–ª–ª–∞'"},
    "–ú—è—Å–Ω–∞—è": {"price": 315, "desc": "–ü–∏—Ü—Ü–∞-—Å–æ—É—Å, –∫–æ–ª–±–∞—Å–∫–∏ '–ü–µ–ø–ø–µ—Ä–æ–Ω–∏', –≥–æ–≤—è–¥–∏–Ω–∞, –≤–µ—Ç—á–∏–Ω–∞, –±–µ–∫–æ–Ω, –°—ã—Ä '–ú–æ—Ü–∞—Ä–µ–ª–ª–∞'"},
    "–ë—å—è–Ω–∫–∞": {"price": 335, "desc": "–ß–µ—Å–Ω–æ—á–Ω—ã–π —Å–æ—É—Å, —à–ø–∏–Ω–∞—Ç, —à–∞–º–ø–∏–Ω—å–æ–Ω—ã, —Ü—ã–ø–ª–µ–Ω–æ–∫, —Å–ª–∏–≤–æ—á–Ω—ã–π —Å—ã—Ä, –ü–∞—Ä–º–µ–∑–∞–Ω, —Å—ã—Ä '–ú–æ—Ü–∞—Ä–µ–ª–ª–∞'"},
    "–¢–µ—Ö–∞—Å": {"price": 335, "desc": "–ü–∏—Ü—Ü–∞-—Å–æ—É—Å, —Ç–æ–º–∞—Ç—ã, —Å–ª–∞–¥–∫–∏–π –ø–µ—Ä–µ—Ü, –∫—Ä–∞—Å–Ω—ã–π –ª—É–∫, –æ—Å—Ç—Ä—ã–µ –ø–µ—Ä—á–∏–∫–∏ –•–∞–ª–∞–ø–µ–Ω—å–æ, –≥–æ–≤—è–¥–∏–Ω–∞, —Å—ã—Ä '–ú–æ—Ü–∞—Ä–µ–ª–ª–∞'"},
    "–ú–æ—Ä—Å–∫–∞—è": {"price": 335, "desc": "–°–æ—É—Å '–†–∞–Ω—á', –∫—Ä–∞—Å–Ω—ã–π –ª—É–∫, –º–∞—Å–ª–∏–Ω—ã, '—Å–Ω–µ–∂–Ω—ã–π –∫—Ä–∞–±', –∫—Ä–µ–≤–µ—Ç–∫–∞, —Å—ã—Ä '–ú–æ—Ü–∞—Ä–µ–ª–ª–∞'"},
    "–ß–∏–∑–±—É—Ä–≥–µ—Ä": {"price": 335, "desc": "–°—ã—Ä–Ω—ã–π —Å–æ—É—Å, —Ç–æ–º–∞—Ç—ã, –∫—Ä–∞—Å–Ω—ã–π –ª—É–∫, –º–∞—Ä–∏–Ω–æ–≤–∞–Ω–Ω—ã–µ –æ–≥—É—Ä—á–∏–∫–∏, –≥–æ–≤—è–¥–∏–Ω–∞, –±–µ–∫–æ–Ω, —Å—ã—Ä '–ú–æ—Ü–∞—Ä–µ–ª–ª–∞', –∫—É–Ω–∂—É—Ç–Ω—ã–µ –±–æ—Ä—Ç–∏–∫–∏"},
    "–ê–ª—å–º–∞": {"price": 315, "desc": "–ß–µ—Å–Ω–æ—á–Ω—ã–π —Å–æ—É—Å, —Å–æ—É—Å '–ü–∞—Ä–º–µ–¥–∂–∞–Ω–æ', —Ü—ã–ø–ª–µ–Ω–æ–∫, —à–ø–∏–Ω–∞—Ç, —Ü–≤–µ—Ç–Ω–∞—è –∫–∞–ø—É—Å—Ç–∞, —Å—ã—Ä '–ú–æ—Ü–∞—Ä–µ–ª–ª–∞'"},
    "–î—é—à–µ—Å": {"price": 315, "desc": "–°–ª–∏–≤–æ—á–Ω—ã–π —Å—ã—Ä, –∂–∞—Ä–µ–Ω—ã–π –±–µ–∫–æ–Ω, –≥—Ä—É—à–∞, –º—ë–¥, —Å–æ—É—Å '–†–∞–Ω—á', –∫–æ—Ä–∏—Ü–∞, —Å—ã—Ä '–ú–æ—Ü–∞—Ä–µ–ª–ª–∞'"}
}

# --- –°–æ—É—Å—ã ---
sauces = ["üßÄ –°—ã—Ä–Ω—ã–π", "üçñ –ë–∞—Ä–±–µ–∫—é", "ü§î –ß–µ—Å–Ω–æ—á–Ω—ã–π", "ü•´ –ö–µ—Ç—á—É–ø", "üçÆ –ö–∏—Å–ª–æ-—Å–ª–∞–¥–∫–∏–π", "üå≠ –ì–æ—Ä—á–∏—á–Ω—ã–π"]

# –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
user_choice = {}

# --- –°—Ç–∞—Ä—Ç–æ–≤–æ–µ –º–µ–Ω—é ---
@dp.message(Command("start"))
async def start_cmd(message: types.Message):
    kb = [[KeyboardButton(text=pizza)] for pizza in pizzas.keys()]
    keyboard = ReplyKeyboardMarkup(keyboard=kb, resize_keyboard=True)
    await message.answer("–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Pizza Bursa! üçï\n–í—ã–±–µ—Ä–∏—Ç–µ –ø–∏—Ü—Ü—É:", reply_markup=keyboard)

# --- –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –ø–∏—Ü—Ü—ã ---
@dp.message(F.text.in_(pizzas.keys()))
async def choose_pizza(message: types.Message):
    pizza = message.text
    user_choice[message.from_user.id] = {"pizza": pizza}

    kb = [[KeyboardButton(text=sauce)] for sauce in sauces]
    keyboard = ReplyKeyboardMarkup(keyboard=kb, resize_keyboard=True)

    await message.answer(
        f"–í—ã –≤—ã–±—Ä–∞–ª–∏ –ø–∏—Ü—Ü—É <b>{pizza}</b> –∑–∞ {pizzas[pizza]['price']} —Ä—É–±.\n"
        f"–°–æ—Å—Ç–∞–≤: {pizzas[pizza]['desc']}\n\n–¢–µ–ø–µ—Ä—å –≤—ã–±–µ—Ä–∏—Ç–µ —Å–æ—É—Å (–±–µ—Å–ø–ª–∞—Ç–Ω–æ):",
        parse_mode="HTML",
        reply_markup=keyboard
    )

# --- –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Å–æ—É—Å–∞ ---
@dp.message(F.text.in_(sauces))
async def choose_sauce(message: types.Message):
    sauce = message.text
    user_choice[message.from_user.id]["sauce"] = sauce

    pizza = user_choice[message.from_user.id]["pizza"]
    await message.answer(
        f"‚úÖ –û—Ç–ª–∏—á–Ω—ã–π –≤—ã–±–æ—Ä!\n–í—ã –∑–∞–∫–∞–∑–∞–ª–∏: <b>{pizza}</b> + {sauce}\n\n–í–∞—à –∑–∞–∫–∞–∑ –ø–µ—Ä–µ–¥–∞–Ω –Ω–∞ –∫—É—Ö–Ω—é! üë®‚Äçüç≥",
        parse_mode="HTML"
    )

async def main():
    await dp.start_polling(bot)

if __name__ == "__main__":
    asyncio.run(main())
